---
title: Metrics
---
- reviews = Movielog.reviews_by_title
- cast_and_crew = Movielog.cast_and_crew

.metrics
  .metrics-sidebar
    .metrics-panel
      %h1.metrics-title
        Metrics


    .metrics-category
      %h2.metrics-category_title
        Most Watched
      %ul.metrics-nav
        %li.metrics-nav_item
          %a.metrics-nav_item_link{ href: '#most-watched-titles'}
            Titles
        %li.metrics-nav_item
          %a.metrics-nav_item_link{ href: '#most-watched-directors'}
            Directors
        %li.metrics-nav_item
          %a.metrics-nav_item_link{ href: '#most-watched-performers'}
            Performers
        %li.metrics-nav_item
          %a.metrics-nav_item_link{ href: '#most-watched-writers'}
            Writers
  .metrics-main
    #most-watched-titles.metrics-table_heading Most Watched Titles
    %table.metrics-table
      %thead
        %tr
          %th
            Title
          %th.numeric
            Viewings
      %tbody
        - Movielog::Db::QueryMostWatchedTitles.call(db: Movielog.db, limit: 5).each do |result|
          %tr
            %td
              - if reviews.key?(result.title)
                %a{ href: "/reviews/#{reviews[result.title].slug}/" }
                  = result.display_title
              - else
                = result.display_title
            %td.numeric
              %a{ href: "/viewings/?title=#{URI.escape(result.display_title)}", data: { no_carnac: true } }
                = result.count

    #most-watched-directors.metrics-table_heading Most Watched Directors
    %table.metrics-table
      %thead
        %tr
          %th
            Director
          %th.numeric
            Viewings
      %tbody
        - Movielog::Db::QueryMostWatchedDirectors.call(db: Movielog.db, limit: 5).each do |result|
          %tr
            %td
              = cast_and_crew_link(result)
            %td.numeric
              = result.count

    #most-watched-performers.metrics-table_heading Most Watched Performers
    %table.metrics-table
      %thead
        %tr
          %th
            Performer
          %th.numeric
            Viewings
      %tbody
        - Movielog::Db::QueryMostWatchedPerformers.call(db: Movielog.db, limit: 5).each do |result|
          %tr
            %td
              = cast_and_crew_link(result)
            %td.numeric
              = result.count

    #most-watched-writers.metrics-table_heading Most Watched Writers
    %table.metrics-table
      %thead
        %tr
          %th
            Writer
          %th.numeric
            Viewings
      %tbody
        - Movielog::Db::QueryMostWatchedWriters.call(db: Movielog.db, limit: 5).each do |result|
          %tr
            %td
              = cast_and_crew_link(result)
            %td.numeric
              = result.count
